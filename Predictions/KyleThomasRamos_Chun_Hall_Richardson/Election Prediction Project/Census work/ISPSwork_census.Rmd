---
title: "ISPS - Election Forecasting"
author: "Liam Richardson"
date: "2024-10-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Phase 1 â€” Predicting the Presidential Vote Margin

Briefly, in our model, we want to predict all races downstream of the presidential race.
This stems from a 

```{r}
library(dplyr)
library(stringr)
#install.packages("remotes")
library(remotes)
remotes::install_github("kuriwaki/ccesMRPprep")
library(ccesMRPprep)
```

```{r}
cd_info_2020
```
Want to add DC-01 to this (even though it's not a typical congressional district)

```{r}
#This is all for 20XX data, but for expediency, I'm not changing the code (except where data is imported) until the end

census_oneyear <- read.csv("/Users/liam/Downloads/courses/PLSC_204/ISPS Election Prediction/one_year_census/ACSDP1Y2023.DP05-Data.csv")

census_oneyear_original <- census_oneyear #backup

#renaming columns to something more typically recognizable
colnames(census_oneyear) <- census_oneyear[1,]
census_oneyear <- census_oneyear[-1,]

colnames(census_oneyear)[colnames(census_oneyear) == "Geographic Area Name"] = "name"

#removing duplicate rows (weirdly every row was duplicated in 2017)
census_oneyear <- distinct(census_oneyear)

#renaming rows so the indexing isn't wrong
rownames(census_oneyear) <- NULL 

#adding a new state column (for merging with congressional district dataset)
census_oneyear$state <- str_split_fixed(census_oneyear$name, ", ", 2)[,2]
#using regex state abbreviations in R to recode states as abbreviation
census_oneyear$state_ab <- state.abb[match(census_oneyear$state, state.name)]
#looking at NA rows (since we want to preserve DC)
census_NAstate <- census_oneyear[is.na(census_oneyear$state_ab),]

string_dc <- census_oneyear$Geography[census_oneyear$name == census_NAstate$name[1]]
string_pr <- census_oneyear$Geography[census_oneyear$name == census_NAstate$name[2]]

census_oneyear$state_ab[census_oneyear$Geography == string_dc] <- "DC" #giving DC a "state" abbreviation
census_oneyear <- census_oneyear[!census_oneyear$Geography == string_pr, ] #removing PR

#coding district number
census_oneyear$districtnum <- str_split_fixed(census_oneyear$name, " \\(", 2)[,1]
census_oneyear$districtnum[census_oneyear$districtnum == "Congressional District"] <- "Congressional District 1"
census_oneyear$districtnum[census_oneyear$districtnum == "Delegate District"] <- "Congressional District 1" #for DC 
census_oneyear$num <- str_split_fixed(census_oneyear$districtnum, " ", 3)[,3]
#table(census_oneyear$districtnum)

#creating a district column with the same formatting as in our CD election info dataframe
census_oneyear$cd <- paste(census_oneyear$state_ab, census_oneyear$num, sep="-")

```


```{r}
#now that our data can more easily be merged with the data above, we clear it up to better serve our purposes
#colnames(census_oneyear)

#str_split_fixed(census_oneyear$name, "\\!\\!", 2)[,1]

#for next phase, create a new dataframe
census_c <- census_oneyear

#We don't have use for the margin of error columns for our complexixty of model
census_c[nrow(census_c) +1,] = str_split_fixed(colnames(census_c), "!!", 3)[,1]
nrow(census_c)

elims <- census_c[nrow(census_c),] %in% c("Margin of Error", "Percent Margin of Error") 
census_c <- census_c[ ,!colnames(census_c) %in% colnames(census_c)[elims]]

#dropping the row we added for elimintation
census_c <- census_c[-nrow(census_c), ]

#dropping columns of NAs
not_all_na <- function(x) any(!is.na(x))
census_c <- census_c %>% select(where(not_all_na))

#census__est <- census_c[!437 %in% c("Margin of Error", "Percent Margin of Error"))

#converting "N" to 0 (this works both for percents and for estimates, and eases inferences versus NA)

census_c <- replace(census_c, census_c == "N", 0)

census2023_c <- census_c

write.csv(census2023_c,"~/Downloads/clean2023census.csv", row.names = FALSE)

```





















## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
