---
title: "Untitled"
output: html_document
date: "2024-10-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#loading data
final_data <- read.csv("data/full_district_data_v2.csv")

```

```{r}
#explore data
colnames(final_data)

#adding a col called rep_pres_votes
final_data$rep_pres_votes_now <- final_data$rep_pct_pres_now * final_data$presvotes_total_now
final_data$rep_pres_votes_last <- final_data$rep_pct_pres_last * final_data$presvotes_total_last
  
```

```{r}
#model to predict rep_pres_votes

P1_lm1 = lm(rep_pres_votes_now ~ relative_partisanship_CPVI + rep_pres_votes_last + total_housing_units + factor(state_ab) + pct_male + pct_white + pct_senior + median_age + presvotes_total_last, data = final_data)

summary(P1_lm1)

```

```{r}
#final data but only for 2024 and with cd, year, state_ab

pred_data_2024 <- final_data[final_data$year == 2024, c("cd", "year", "state_ab", "rep_pres_votes_last", "presvotes_total_last", "relative_partisanship_CPVI", "rep_pres_votes_last", "total_housing_units", "pct_male", "pct_white", "pct_senior", "median_age", "total_population", "rep_pct_pres_last", "est_voting_age_pop")]

```

```{r}

#use model to predict rep_pres_votes for 2024

pred_data_2024$rep_pres_votes_pred <- predict(P1_lm1, newdata = pred_data_2024)

```

```{r}

#now need to predict turnout, presvotes_total_now

P2_lm1 = lm(presvotes_total_now ~ relative_partisanship_CPVI + rep_pres_votes_last + total_housing_units + factor(state_ab) + total_population + rep_pct_pres_last + pct_senior + median_age + est_voting_age_pop + pct_white + pct_male, data = final_data)

summary(P2_lm1)

```

```{r}
#adding presvotes_total_now predictions to pred_data_2024

pred_data_2024$presvotes_total_pred <- predict(P2_lm1, newdata = pred_data_2024)

```

```{r}
library(dplyr)


#sum up rep_pres_votes_pred and rep_pres_votes_last for each state

PQ1 = pred_data_2024|>
  group_by(state_ab) |>
  summarise(rep_pres_votes_pred = sum(rep_pres_votes_pred), presvotes_total_pred = sum(presvotes_total_pred), pct_rep_pres_pred = sum(rep_pres_votes_pred) / sum(presvotes_total_pred))
            
```

```{r}
#predictions for each district where state_ab = NE or ME with only columns "state_ab", "rep_pres_votes_pred", 'presvotes_total_pred", "pct_rep_pres_pred"   

pred_data_2024_NE_ME = pred_data_2024[pred_data_2024$state_ab %in% c("NE", "ME"),]

#recoding state_ab as cd
pred_data_2024_NE_ME$state_ab = pred_data_2024_NE_ME$cd

#selecting only columns "state_ab", "rep_pres_votes_pred", 'presvotes_total_pred", "pct_rep_pres_pred"
pred_data_2024_NE_ME = pred_data_2024_NE_ME[c("state_ab", "rep_pres_votes_pred", "presvotes_total_pred")]

#adding pct_rep_pres_pred
pred_data_2024_NE_ME$pct_rep_pres_pred = pred_data_2024_NE_ME$rep_pres_votes_pred / pred_data_2024_NE_ME$presvotes_total_pred

```

```{r}

#add to end of PQ1
PQ1 = rbind(PQ1, pred_data_2024_NE_ME)

```

```{r}
library(write_xlsx)

write_xlsx(PQ1, "data/predictions_PQ1,2.xlsx")

```

```{r}
state_data = read.csv("data/full_state_data.csv")

```

```{r}
#add a variable to final_data that is the num_rep_H_votes

final_data$num_rep_H_votes = final_data$rep_pct_house_race * final_data$house_votes_total

```

```{r}
#build a model to predict num_rep_H_votes

P4_lm1 = lm(num_rep_H_votes ~ relative_partisanship_CPVI + rep_pres_votes_last + total_housing_units + factor(state_ab) + total_population + rep_pct_pres_last + pct_senior + median_age + est_voting_age_pop + r_cand_house + d_cand_house, data = final_data)

summary(P4_lm1)

```

```{r}

```











